name: ğŸš€ Deploy Games (Netlify - Disabled)

# æ­¤å·¥ä½œæµå·²ç¦ç”¨ï¼Œä½¿ç”¨ deploy-gh-pages.yml è¿›è¡Œ GitHub Pages éƒ¨ç½²
# This workflow is disabled, use deploy-gh-pages.yml for GitHub Pages deployment

on:
  workflow_dispatch:  # ä»…æ‰‹åŠ¨è§¦å‘

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        game: [snake-game]
        node-version: [18.x]
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
      
      - name: ğŸ“¦ Setup Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'
          cache-dependency-path: '${{ matrix.game }}/package-lock.json'
      
      - name: ğŸ“š Install dependencies
        working-directory: ${{ matrix.game }}
        run: npm ci
      
      - name: ğŸ” Run linter (if available)
        working-directory: ${{ matrix.game }}
        run: npm run lint --if-present
        continue-on-error: true
      
      - name: ğŸ§ª Run tests (if available)
        working-directory: ${{ matrix.game }}
        run: npm test --if-present
        continue-on-error: true
      
      - name: ğŸ—ï¸ Build project
        working-directory: ${{ matrix.game }}
        run: npm run build
      
      - name: ğŸ“¤ Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.game }}-dist
          path: ${{ matrix.game }}/dist
          retention-days: 7
      
      - name: ğŸš€ Deploy to Netlify
        if: github.event_name == 'push' && github.ref == 'refs/heads/main'
        uses: netlify/actions/build@master
        with:
          args: deploy --prod --dir=${{ matrix.game }}/dist
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
      
      - name: ğŸ“ Create deployment summary
        if: github.event_name == 'push' && github.ref == 'refs/heads/main'
        run: |
          echo "## ğŸ® ${{ matrix.game }} Deployment Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… Build completed successfully" >> $GITHUB_STEP_SUMMARY
          echo "ğŸ“¦ Artifact: ${{ matrix.game }}-dist" >> $GITHUB_STEP_SUMMARY
          echo "ğŸš€ Deployed to Netlify" >> $GITHUB_STEP_SUMMARY

  deploy-status:
    runs-on: ubuntu-latest
    needs: build-and-deploy
    if: always()
    
    steps:
      - name: ğŸ“Š Deployment Status
        run: |
          if [ "${{ needs.build-and-deploy.result }}" == "success" ]; then
            echo "âœ… All games deployed successfully!"
          else
            echo "âŒ Deployment failed"
            exit 1
          fi
